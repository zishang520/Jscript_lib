function utf8_encode(t){if(null===t||"undefined"==typeof t)return"";var r,e,n=t+"",o="",a=0;r=e=0,a=n.length;for(var u=0;a>u;u++){var i=n.charCodeAt(u),s=null;if(128>i)e++;else if(i>127&&2048>i)s=String.fromCharCode(i>>6|192,63&i|128);else if(55296!=(63488&i))s=String.fromCharCode(i>>12|224,i>>6&63|128,63&i|128);else{if(55296!=(64512&i))throw new RangeError("Unmatched trail surrogate at "+u);var h=n.charCodeAt(++u);if(56320!=(64512&h))throw new RangeError("Unmatched lead surrogate at "+(u-1));i=((1023&i)<<10)+(1023&h)+65536,s=String.fromCharCode(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}null!==s&&(e>r&&(o+=n.slice(r,e)),o+=s,r=e=u+1)}return e>r&&(o+=n.slice(r,a)),o}function md5(t){var r,e,n,o,a,u,i,s,h,f,g=function(t,r){return t<<r|t>>>32-r},c=function(t,r){var e,n,o,a,u;return o=2147483648&t,a=2147483648&r,e=1073741824&t,n=1073741824&r,u=(1073741823&t)+(1073741823&r),e&n?2147483648^u^o^a:e|n?1073741824&u?3221225472^u^o^a:1073741824^u^o^a:u^o^a},p=function(t,r,e){return t&r|~t&e},d=function(t,r,e){return t&e|r&~e},m=function(t,r,e){return t^r^e},l=function(t,r,e){return r^(t|~e)},w=function(t,r,e,n,o,a,u){return t=c(t,c(c(p(r,e,n),o),u)),c(g(t,a),r)},C=function(t,r,e,n,o,a,u){return t=c(t,c(c(d(r,e,n),o),u)),c(g(t,a),r)},y=function(t,r,e,n,o,a,u){return t=c(t,c(c(m(r,e,n),o),u)),c(g(t,a),r)},_=function(t,r,e,n,o,a,u){return t=c(t,c(c(l(r,e,n),o),u)),c(g(t,a),r)},v=function(t){for(var r,e=t.length,n=e+8,o=(n-n%64)/64,a=16*(o+1),u=new Array(a-1),i=0,s=0;e>s;)r=(s-s%4)/4,i=s%4*8,u[r]=u[r]|t.charCodeAt(s)<<i,s++;return r=(s-s%4)/4,i=s%4*8,u[r]=u[r]|128<<i,u[a-2]=e<<3,u[a-1]=e>>>29,u},b=function(t){var r,e,n="",o="";for(e=0;3>=e;e++)r=t>>>8*e&255,o="0"+r.toString(16),n+=o.substr(o.length-2,2);return n},k=[],S=7,E=12,W=17,A=22,T=5,j=9,N=14,M=20,x=4,H=11,P=16,I=23,q=6,X=10,$=15,O=21;for(t=utf8_encode(t),k=v(t),i=1732584193,s=4023233417,h=2562383102,f=271733878,r=k.length,e=0;r>e;e+=16)n=i,o=s,a=h,u=f,i=w(i,s,h,f,k[e+0],S,3614090360),f=w(f,i,s,h,k[e+1],E,3905402710),h=w(h,f,i,s,k[e+2],W,606105819),s=w(s,h,f,i,k[e+3],A,3250441966),i=w(i,s,h,f,k[e+4],S,4118548399),f=w(f,i,s,h,k[e+5],E,1200080426),h=w(h,f,i,s,k[e+6],W,2821735955),s=w(s,h,f,i,k[e+7],A,4249261313),i=w(i,s,h,f,k[e+8],S,1770035416),f=w(f,i,s,h,k[e+9],E,2336552879),h=w(h,f,i,s,k[e+10],W,4294925233),s=w(s,h,f,i,k[e+11],A,2304563134),i=w(i,s,h,f,k[e+12],S,1804603682),f=w(f,i,s,h,k[e+13],E,4254626195),h=w(h,f,i,s,k[e+14],W,2792965006),s=w(s,h,f,i,k[e+15],A,1236535329),i=C(i,s,h,f,k[e+1],T,4129170786),f=C(f,i,s,h,k[e+6],j,3225465664),h=C(h,f,i,s,k[e+11],N,643717713),s=C(s,h,f,i,k[e+0],M,3921069994),i=C(i,s,h,f,k[e+5],T,3593408605),f=C(f,i,s,h,k[e+10],j,38016083),h=C(h,f,i,s,k[e+15],N,3634488961),s=C(s,h,f,i,k[e+4],M,3889429448),i=C(i,s,h,f,k[e+9],T,568446438),f=C(f,i,s,h,k[e+14],j,3275163606),h=C(h,f,i,s,k[e+3],N,4107603335),s=C(s,h,f,i,k[e+8],M,1163531501),i=C(i,s,h,f,k[e+13],T,2850285829),f=C(f,i,s,h,k[e+2],j,4243563512),h=C(h,f,i,s,k[e+7],N,1735328473),s=C(s,h,f,i,k[e+12],M,2368359562),i=y(i,s,h,f,k[e+5],x,4294588738),f=y(f,i,s,h,k[e+8],H,2272392833),h=y(h,f,i,s,k[e+11],P,1839030562),s=y(s,h,f,i,k[e+14],I,4259657740),i=y(i,s,h,f,k[e+1],x,2763975236),f=y(f,i,s,h,k[e+4],H,1272893353),h=y(h,f,i,s,k[e+7],P,4139469664),s=y(s,h,f,i,k[e+10],I,3200236656),i=y(i,s,h,f,k[e+13],x,681279174),f=y(f,i,s,h,k[e+0],H,3936430074),h=y(h,f,i,s,k[e+3],P,3572445317),s=y(s,h,f,i,k[e+6],I,76029189),i=y(i,s,h,f,k[e+9],x,3654602809),f=y(f,i,s,h,k[e+12],H,3873151461),h=y(h,f,i,s,k[e+15],P,530742520),s=y(s,h,f,i,k[e+2],I,3299628645),i=_(i,s,h,f,k[e+0],q,4096336452),f=_(f,i,s,h,k[e+7],X,1126891415),h=_(h,f,i,s,k[e+14],$,2878612391),s=_(s,h,f,i,k[e+5],O,4237533241),i=_(i,s,h,f,k[e+12],q,1700485571),f=_(f,i,s,h,k[e+3],X,2399980690),h=_(h,f,i,s,k[e+10],$,4293915773),s=_(s,h,f,i,k[e+1],O,2240044497),i=_(i,s,h,f,k[e+8],q,1873313359),f=_(f,i,s,h,k[e+15],X,4264355552),h=_(h,f,i,s,k[e+6],$,2734768916),s=_(s,h,f,i,k[e+13],O,1309151649),i=_(i,s,h,f,k[e+4],q,4149444226),f=_(f,i,s,h,k[e+11],X,3174756917),h=_(h,f,i,s,k[e+2],$,718787259),s=_(s,h,f,i,k[e+9],O,3951481745),i=c(i,n),s=c(s,o),h=c(h,a),f=c(f,u);var D=b(i)+b(s)+b(h)+b(f);return D.toLowerCase()}function rand(t,r){var e=arguments.length;if(0===e)t=0,r=2147483647;else if(1===e)throw new Error("Warning: rand() expects exactly 2 parameters, 1 given");return Math.floor(Math.random()*(r-t+1))+t}function uniqid(t,r){"undefined"==typeof t&&(t="");var e,n=function(t,r){return t=parseInt(t,10).toString(16),r<t.length?t.slice(t.length-r):r>t.length?Array(1+(r-t.length)).join("0")+t:t};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,e=t,e+=n(parseInt((new Date).getTime()/1e3,10),8),e+=n(this.php_js.uniqidSeed,5),r&&(e+=(10*Math.random()).toFixed(8).toString()),e}function microtime(t){var r=(new Date).getTime()/1e3,e=parseInt(r,10);return t?r:Math.round(1e3*(r-e))/1e3+" "+e}function pack(t){for(var r,e,n,o,a,u,i,s,h,f,g,c,p,d,m,l,w,C,y,_,v,b,k,S=0,E=1,W="",A="",T=0,j=[];S<t.length;){for(r=t.charAt(S),e="",S++;S<t.length&&null!==t.charAt(S).match(/[\d\*]/);)e+=t.charAt(S),S++;switch(""===e&&(e="1"),r){case"a":case"A":if("undefined"==typeof arguments[E])throw new Error("Warning:  pack() Type "+r+": not enough arguments");for(A=String(arguments[E]),"*"===e&&(e=A.length),T=0;e>T;T++)W+="undefined"==typeof A[T]?"a"===r?String.fromCharCode(0):" ":A[T];E++;break;case"h":case"H":if("undefined"==typeof arguments[E])throw new Error("Warning: pack() Type "+r+": not enough arguments");if(A=arguments[E],"*"===e&&(e=A.length),e>A.length)throw new Error("Warning: pack() Type "+r+": not enough characters in string");for(T=0;e>T;T+=2)n=A[T],n+=T+1>=e||"undefined"==typeof A[T+1]?"0":A[T+1],"h"===r&&(n=n[1]+n[0]),W+=String.fromCharCode(parseInt(n,16));E++;break;case"c":case"C":if("*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++)W+=String.fromCharCode(arguments[E]),E++;break;case"s":case"S":case"v":if("*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++)W+=String.fromCharCode(255&arguments[E]),W+=String.fromCharCode(arguments[E]>>8&255),E++;break;case"n":if("*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++)W+=String.fromCharCode(arguments[E]>>8&255),W+=String.fromCharCode(255&arguments[E]),E++;break;case"i":case"I":case"l":case"L":case"V":if("*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++)W+=String.fromCharCode(255&arguments[E]),W+=String.fromCharCode(arguments[E]>>8&255),W+=String.fromCharCode(arguments[E]>>16&255),W+=String.fromCharCode(arguments[E]>>24&255),E++;break;case"N":if("*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++)W+=String.fromCharCode(arguments[E]>>24&255),W+=String.fromCharCode(arguments[E]>>16&255),W+=String.fromCharCode(arguments[E]>>8&255),W+=String.fromCharCode(255&arguments[E]),E++;break;case"f":case"d":if(o=23,a=8,"d"===r&&(o=52,a=11),"*"===e&&(e=arguments.length-E),e>arguments.length-E)throw new Error("Warning:  pack() Type "+r+": too few arguments");for(T=0;e>T;T++){for(A=arguments[E],i=Math.pow(2,a-1)-1,s=-i+1,h=i,f=s-o,g=isNaN(l=parseFloat(A))||l===-(1/0)||l===+(1/0)?l:0,c=0,p=2*i+1+o+3,d=new Array(p),m=(l=0!==g?0:l)<0,l=Math.abs(l),w=Math.floor(l),C=l-w,b=p;b;)d[--b]=0;for(b=i+2;w&&b;)d[--b]=w%2,w=Math.floor(w/2);for(b=i+1;C>0&&b;--C)d[++b]=((C*=2)>=1)-0;for(b=-1;++b<p&&!d[b];);if(d[(y=o-1+(b=(c=i+1-b)>=s&&h>=c?b+1:i+1-(c=s-1)))+1]){if(!(_=d[y]))for(v=y+2;!_&&p>v;_=d[v++]);for(v=y+1;_&&--v>=0;(d[v]=!d[v]-0)&&(_=0));}for(b=0>b-2?-1:b-3;++b<p&&!d[b];);for((c=i+1-b)>=s&&h>=c?++b:s>c&&(b=i+1-(c=s-1)),(w||0!==g)&&(c=h+1,b=i+2,g===-(1/0)?m=1:isNaN(g)&&(d[b]=1)),l=Math.abs(c+i),k="",v=a+1;--v;)k=l%2+k,l=l>>=1;for(l=0,v=0,b=(k=(m?"1":"0")+k+d.slice(b,b+o).join("")).length,j=[];b;)l+=(1<<v)*k.charAt(--b),7===v&&(j[j.length]=String.fromCharCode(l),l=0),v=(v+1)%8;j[j.length]=l?String.fromCharCode(l):"",W+=j.join(""),E++}break;case"x":if("*"===e)throw new Error("Warning: pack(): Type x: '*' ignored");for(T=0;e>T;T++)W+=String.fromCharCode(0);break;case"X":if("*"===e)throw new Error("Warning: pack(): Type X: '*' ignored");for(T=0;e>T;T++){if(0===W.length)throw new Error("Warning: pack(): Type X: outside of string");W=W.substring(0,W.length-1)}break;case"@":if("*"===e)throw new Error("Warning: pack(): Type X: '*' ignored");if(e>W.length)for(u=e-W.length,T=0;u>T;T++)W+=String.fromCharCode(0);e<W.length&&(W=W.substring(0,e));break;default:throw new Error("Warning:  pack() Type "+r+": unknown format code")}}if(E<arguments.length)throw new Error("Warning: pack(): "+(arguments.length-E)+" arguments unused");return W}function ord(t){var r=t+"",e=r.charCodeAt(0);if(e>=55296&&56319>=e){var n=e;if(1===r.length)return e;var o=r.charCodeAt(1);return 1024*(n-55296)+(o-56320)+65536}return e>=56320&&57343>=e?e:e}function min(){var t,r,e=0,n=0,o=arguments,a=o.length,u=function(t){if("[object Array]"===Object.prototype.toString.call(t))return t;var r=[];for(var e in t)t.hasOwnProperty(e)&&r.push(t[e]);return r};if(_compare=function(t,r){var e=0,n=0,o=0,a=0,i=0;if(t===r)return 0;if("object"==typeof t){if("object"==typeof r){if(t=u(t),r=u(r),i=t.length,a=r.length,a>i)return 1;if(i>a)return-1;for(e=0,n=i;n>e;++e){if(o=_compare(t[e],r[e]),1==o)return 1;if(-1==o)return-1}return 0}return-1}return"object"==typeof r?1:isNaN(r)&&!isNaN(t)?0==t?0:0>t?1:-1:isNaN(t)&&!isNaN(r)?0==r?0:r>0?1:-1:r==t?0:r>t?1:-1},0===a)throw new Error("At least one value should be passed to min()");if(1===a){if("object"!=typeof o[0])throw new Error("Wrong parameter count for min()");if(t=u(o[0]),0===t.length)throw new Error("Array must contain at least one element for min()")}else t=o;for(r=t[0],e=1,n=t.length;n>e;++e)-1==_compare(r,t[e])&&(r=t[e]);return r}function strpos(t,r,e){var n=(t+"").indexOf(r,e||0);return-1===n?!1:n}function chr(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)}function PasswordHash(t,r){this.itoa64="./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",(4>t||t>31)&&(t=8),this.iteration_count_log2=t,this.portable_hashes=r,this.random_state=microtime()+uniqid(rand(),!0)}var phtotype=PasswordHash.prototype;phtotype.get_random_bytes=function(t){output="";for(var r=0;t>r;r+=16)this.random_state=md5(microtime()+this.random_state),output+=pack("H*",md5(this.random_state));return output=output.substr(0,t),output},phtotype.encode64=function(t,r){output="",i=0;do{if(value=ord(t[i++]),output+=this.itoa64[63&value],i<r&&(value|=ord(t[i])<<8),output+=this.itoa64[value>>6&63],i++>=r)break;if(i<r&&(value|=ord(t[i])<<16),output+=this.itoa64[value>>12&63],i++>=r)break;output+=this.itoa64[value>>18&63]}while(i<r);return output},phtotype.gensalt_private=function(t){return output="$P$",output+=this.itoa64[min(this.iteration_count_log2+5,30)],output+=this.encode64(t,6),output},phtotype.crypt_private=function(t,r){if(output="*0",r.substr(0,2)==output&&(output="*1"),"$P$"!=r.substr(0,3))return output;if(count_log2=strpos(this.itoa64,r[3]),count_log2<7||count_log2>30)return output;if(count=1<<count_log2,salt=r.substr(4,8),8!=salt.length)return output;hash=pack("H*",md5(salt+t));do hash=pack("H*",md5(hash+t));while(--count);return output=r.substr(0,12),output+=this.encode64(hash,16),output},phtotype.gensalt_extended=function(t){return count_log2=min(this.iteration_count_log2+8,24),count=(1<<count_log2)-1,output="_",output+=this.itoa64[63&count],output+=this.itoa64[count>>6&63],output+=this.itoa64[count>>12&63],output+=this.itoa64[count>>18&63],output+=this.encode64(t,3),output},phtotype.gensalt_blowfish=function(t){for(itoa64="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",output="$2a$",output+=chr(ord("0")+parseInt(this.iteration_count_log2,10)/10),output+=chr(ord("0")+parseInt(this.iteration_count_log2,10)%10),output+="",i=0;;){if(c1=ord(t[i++]),output+=itoa64[c1>>2],c1=(3&c1)<<4,i>=16){output+=itoa64[c1];break}c2=ord(t[i++]),c1|=c2>>4,output+=itoa64[c1],c1=(15&c2)<<2,c2=ord(t[i++]),c1|=c2>>6,output+=itoa64[c1],output+=itoa64[63&c2]}return output},phtotype.HashPassword=function(t){return random="",random.length<6&&(random=this.get_random_bytes(6)),hash=this.crypt_private(t,this.gensalt_private(random)),34==hash.length?hash:"*"},phtotype.CheckPassword=function(t,r){return hash=this.crypt_private(t,r),hash==r},module.exports=PasswordHash;